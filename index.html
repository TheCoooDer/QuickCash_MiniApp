<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickCash - Telegram Mini App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --primary: #FF5252;
            --secondary: #FF4081;
            --success: #00C853;
            --danger: #FF1744;
            --warning: #FFD600;
            --dark: #263238;
            --light: #F5F5F5;
            --gray: #78909C;
            --youtube: #FF0000;
            --telegram: #0088CC;
            --social: #9C27B0;
            --external: #673AB7;
            --checkin: #00897B;
            --link: #2962FF;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background-color: #ECEFF1;
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
            height: 100vh;
        }
        .app-container {
            max-width: 500px;
            margin: 0 auto;
            height: 100vh;
            background-color: white;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        /* Top Bar */
        .top-bar {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid white;
            object-fit: cover;
            background-color: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
        }
        .user-name {
            font-weight: 600;
            font-size: 16px;
        }
        .balance {
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            padding-bottom: 80px;
            overflow-y: auto;
            position: relative;
            height: calc(100vh - 140px);
        }
        .tab-content {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 20px;
            padding-bottom: 80px;
            overflow-y: auto;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
        }
        .tab-content.active {
            display: block;
            opacity: 1;
        }
        /* Dashboard */
        .dashboard-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 20px;
            text-align: center;
            position: relative;
        }
        .dashboard-title::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 2px;
        }
        .dashboard {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.12);
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
            border-radius: 3px 0 0 3px;
        }
        .stat-card h3 {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 12px;
            font-weight: 500;
        }
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: auto;
        }
        .stat-icon {
            position: absolute;
            bottom: 15px;
            right: 15px;
            font-size: 36px;
            opacity: 0.1;
            color: var(--primary);
        }
        /* Progress Container */
        .progress-container {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
        }
        .progress-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--dark);
        }
        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        .progress-bar {
            height: 12px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        .countdown-container {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #FFF8E1, #FFECB3);
            border: 2px solid var(--warning);
            border-radius: 12px;
            margin-top: 15px;
            box-shadow: 0 4px 12px rgba(255, 214, 0, 0.2);
            display: none;
        }
        .countdown-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 8px;
        }
        .countdown {
            font-size: 24px;
            font-weight: 700;
            color: var(--warning);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        .countdown-icon {
            font-size: 20px;
            color: var(--warning);
            margin-right: 8px;
            vertical-align: middle;
        }
        /* Date Container */
        .date-container {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #E3F2FD, #BBDEFB);
            border: 2px solid #2196F3;
            border-radius: 12px;
            margin-top: 15px;
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.2);
        }
        .date-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 8px;
        }
        .date-value {
            font-size: 20px;
            font-weight: 700;
            color: #2196F3;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        .date-icon {
            font-size: 16px;
            color: #2196F3;
            margin-right: 8px;
            vertical-align: middle;
        }
        /* Tasks - IMPROVED DESIGN */
        .task-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        /* Daily Check In Card */
        .checkin-task {
            background: linear-gradient(135deg, var(--checkin), #4DB6AC);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 6px 15px rgba(0, 137, 123, 0.15);
            color: white;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .checkin-task::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(45deg);
        }
        .checkin-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .checkin-icon {
            font-size: 28px;
            color: rgba(255, 255, 255, 0.9);
        }
        .checkin-info {
            text-align: left;
        }
        .checkin-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 2px;
        }
        .checkin-reward {
            font-size: 13px;
            font-weight: 600;
            color: #FFFFFF;
        }
        .checkin-btn {
            background: white;
            color: var(--checkin);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            white-space: nowrap;
            z-index: 0;
        }
        .checkin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }
        .checkin-btn:disabled {
            background: rgba(255, 255, 255, 0.5);
            cursor: not-allowed;
            transform: none;
        }
        /* Featured Ad Task */
        .featured-task {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 6px 15px rgba(255, 82, 82, 0.15);
            color: white;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .featured-task::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(45deg);
        }
        .featured-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .featured-icon {
            font-size: 28px;
            color: rgba(255, 255, 255, 0.9);
        }
        .featured-info {
            text-align: left;
        }
        .featured-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 2px;
        }
        .featured-reward {
            font-size: 13px;
            font-weight: 600;
            color: var(--warning);
        }
        .featured-btn {
            background: white;
            color: var(--primary);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            white-space: nowrap;
            z-index: 0;
            position: relative;
        }
        .featured-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }
        .featured-btn:disabled {
            background: rgba(255, 255, 255, 0.5);
            cursor: not-allowed;
            transform: none;
        }
        /* YouTube and Telegram Tasks */
        .youtube-task {
            background: linear-gradient(135deg, var(--youtube), #D50000);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 6px 15px rgba(255, 0, 0, 0.15);
            color: white;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .youtube-task::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(45deg);
        }
        .telegram-task {
            background: linear-gradient(135deg, var(--telegram), #006699);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 6px 15px rgba(0, 136, 204, 0.15);
            color: white;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .telegram-task::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(45deg);
        }
        .task-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .task-icon {
            font-size: 28px;
            color: rgba(255, 255, 255, 0.9);
        }
        .task-info {
            text-align: left;
        }
        .task-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 2px;
        }
        .task-reward {
            font-size: 13px;
            font-weight: 600;
            color: var(--warning);
        }
        .task-btn {
            background: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            white-space: nowrap;
            position: relative;
            z-index: 1;
        }
        .youtube-task .task-btn {
            color: var(--youtube);
        }
        .telegram-task .task-btn {
            color: var(--telegram);
        }
        .task-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }
        .task-btn:disabled {
            background: rgba(255, 255, 255, 0.5);
            cursor: not-allowed;
            transform: none;
        }
        /* Referral */
        .referral-container {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }
        .referral-header {
            text-align: center;
            margin-bottom: 20px;
        }
        .referral-header h2 {
            font-size: 22px;
            color: var(--dark);
            margin-bottom: 10px;
        }
        .referral-header p {
            color: var(--gray);
            font-size: 14px;
        }
        .referral-link-container {
            background: #F5F5F5;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .referral-link {
            flex: 1;
            margin-right: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            font-size: 14px;
            color: var(--gray);
            word-break: break-all;
        }
        .copy-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .copy-btn:hover {
            background: var(--secondary);
        }
        .referral-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        .referral-stat {
            background: #F5F5F5;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }
        .referral-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
            min-height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .referral-stat-label {
            font-size: 14px;
            color: var(--gray);
        }
        .referral-info {
            background: #F5F5F5;
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
        }
        .referral-info h3 {
            font-size: 16px;
            color: var(--dark);
            margin-bottom: 10px;
        }
        .referral-info ul {
            padding-left: 20px;
            color: var(--gray);
            font-size: 14px;
        }
        .referral-info li {
            margin-bottom: 5px;
        }
        .referral-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
        }
        /* Referral List */
        .referral-list {
            margin-top: 20px;
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        }
        .referral-list h3 {
            font-size: 18px;
            color: var(--dark);
            margin-bottom: 15px;
            text-align: center;
        }
        .referral-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #F5F5F5;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .referral-item:last-child {
            margin-bottom: 0;
        }
        .referral-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }
        .referral-details {
            flex: 1;
        }
        .referral-name {
            font-weight: 600;
            color: var(--dark);
        }
        .referral-date {
            font-size: 12px;
            color: var(--gray);
        }
        .referral-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .referral-status.pending {
            background-color: #FFF8E1;
            color: var(--warning);
        }
        .referral-status.completed {
            background-color: #E8F5E9;
            color: var(--success);
        }
        /* Support */
        .support-card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }
        .support-card h3 {
            margin-bottom: 20px;
            color: var(--dark);
            font-size: 22px;
            text-align: center;
        }
        .support-card p {
            margin-bottom: 20px;
            text-align: center;
            color: var(--gray);
        }
        .support-link {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #F5F5F5;
            border-radius: 12px;
            margin-bottom: 15px;
            text-decoration: none;
            color: var(--dark);
            transition: all 0.2s;
        }
        .support-link:hover {
            background: #E0E0E0;
            transform: translateX(5px);
        }
        .support-link i {
            font-size: 24px;
        }
        .support-link-details {
            flex: 1;
        }
        .support-link-title {
            font-weight: 600;
            margin-bottom: 2px;
        }
        .support-link-subtitle {
            font-size: 12px;
            color: var(--gray);
        }
        .telegram { color: var(--telegram); }
        .facebook { color: #1877f2; }
        /* Withdraw */
        .withdraw-container {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        }
        .withdraw-container h2 {
            margin-bottom: 25px;
            text-align: center;
            color: var(--dark);
        }
        .withdraw-info {
            background: #F5F5F5;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 25px;
        }
        .withdraw-info h3 {
            margin-bottom: 12px;
            color: var(--dark);
            font-size: 16px;
        }
        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #E0E0E0;
            font-size: 14px;
        }
        .info-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        .withdraw-message {
            background: #FFF8E1;
            border: 1px solid var(--warning);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 20px;
            font-size: 13px;
            color: var(--dark);
            text-align: center;
        }
        .withdraw-message i {
            color: var(--warning);
            margin-right: 5px;
        }
        .withdraw-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .form-group label {
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
        }
        .form-group select,
        .form-group input {
            padding: 12px;
            border: 1px solid #E0E0E0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        .form-group select:focus,
        .form-group input:focus {
            border-color: var(--primary);
            outline: none;
        }
        .withdraw-btn {
            background: linear-gradient(135deg, var(--success), #00A152);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .withdraw-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 200, 83, 0.3);
        }
        .withdraw-btn:disabled {
            background: var(--gray);
            cursor: not-allowed;
            transform: none;
        }

        /* === NEW: Top 5 Withdrawals Section === */
        .top-withdrawals-section {
            margin-top: 25px;
        }
        .top-withdrawals-section h3 {
            font-size: 16px;
            color: var(--dark);
            margin-bottom: 12px;
            text-align: center;
        }
        #topWithdrawalsList {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .withdrawal-proof-card {
            background: #F5F5F5;
            padding: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            color: var(--dark);
        }
        .proof-left .proof-name {
            font-weight: 600;
        }
        .proof-left .proof-method-time {
            font-size: 11px;
            color: var(--gray);
        }
        .proof-right .proof-amount {
            font-weight: 700;
            color: var(--success);
        }
        .proof-right .proof-status {
            font-size: 11px;
            color: var(--success);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 500px;
            margin: 0 auto;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            flex-shrink: 0;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            color: var(--gray);
            text-decoration: none;
            padding: 5px 15px;
            border-radius: 8px;
            transition: all 0.2s;
            cursor: pointer;
        }
        .nav-item.active {
            color: var(--primary);
            background: rgba(255, 82, 82, 0.1);
        }
        .nav-item i {
            font-size: 22px;
        }
        .nav-item span {
            font-size: 12px;
            font-weight: 600;
        }
        /* Notification */
        .notification {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 200;
            display: none;
            align-items: center;
            gap: 10px;
            max-width: 90%;
        }
        .notification.show {
            display: flex;
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown {
            from { transform: translate(-50%, -100%); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }
        .notification.success {
            border-left: 4px solid var(--success);
        }
        .notification.error {
            border-left: 4px solid var(--danger);
        }
        .notification.info {
            border-left: 4px solid var(--primary);
        }
        .notification i {
            font-size: 20px;
        }
        .notification.success i {
            color: var(--success);
        }
        .notification.error i {
            color: var(--danger);
        }
        .notification.info i {
            color: var(--primary);
        }
        /* Responsive */
        @media (max-width: 500px) {
            .app-container {
                max-width: 100%;
            }
        }
        
        /* Link Verification Modal */
        .link-verification-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .link-verification-content {
            background: white;
            border-radius: 16px;
            padding: 25px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        .verification-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 15px;
        }
        .verification-message {
            font-size: 16px;
            color: var(--gray);
            margin-bottom: 20px;
        }
        .verification-timer {
            font-size: 36px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 20px;
        }
        .verification-progress {
            height: 8px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        .verification-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 10px;
            transition: width 1s linear;
            width: 0%;
        }
        .verification-cancel {
            background: #f5f5f5;
            color: var(--dark);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .verification-cancel:hover {
            background: #e0e0e0;
        }
    </style>
    <!-- Updated Ad Script -->
    <script src='//libtl.com/sdk.js' data-zone='9916224' data-sdk='show_9916224'></script>
</head>
<body>
    <div class="app-container">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-name" id="userName">Loading...</div>
            </div>
            <div class="balance">
                <i class="fas fa-coins"></i>
                <span id="userBalance">$0.00</span>
            </div>
        </div>
        <!-- Main Content -->
        <div class="main-content">
            <!-- Home Tab -->
            <div class="tab-content active" id="home-tab">
                <h2 class="dashboard-title">Dashboard</h2>
                <div class="dashboard">
                    <div class="stat-card">
                        <h3>Tasks Done</h3>
                        <div class="stat-value" id="tasksDone">0</div>
                        <i class="fas fa-tasks stat-icon"></i>
                    </div>
                    <div class="stat-card">
                        <h3>Clicks</h3>
                        <div class="stat-value" id="clicks">0</div>
                        <i class="fas fa-mouse-pointer stat-icon"></i>
                    </div>
                    <div class="stat-card">
                        <h3>Total Earning</h3>
                        <div class="stat-value">$<span id="totalEarning">0.00</span></div>
                        <i class="fas fa-coins stat-icon"></i>
                    </div>
                    <div class="stat-card">
                        <h3>Total Refers</h3>
                        <div class="stat-value" id="totalRefers">0</div>
                        <i class="fas fa-users stat-icon"></i>
                    </div>
                </div>
                <!-- Progress Container -->
                <div class="progress-container">
                    <h3 class="progress-title">Daily Task Limit</h3>
                    <div class="progress-header">
                        <span>Progress</span>
                        <span id="taskLimitText">0 of 35</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="taskProgress" style="width: 0%"></div>
                    </div>
                    <!-- Enhanced Countdown Timer -->
                    <div class="countdown-container" id="countdownContainer">
                        <div class="countdown-label">
                            <i class="fas fa-clock countdown-icon"></i>
                            Tasks available in:
                        </div>
                        <div class="countdown" id="countdown">--:--:--</div>
                    </div>
                    <!-- Date Display -->
                    <div class="date-container">
                        <div class="date-label">
                            <i class="fas fa-calendar-alt date-icon"></i>
                            Today's Date
                        </div>
                        <div class="date-value" id="currentDate">Loading...</div>
                    </div>
                </div>
            </div>
            <!-- Tasks Tab -->
            <div class="tab-content" id="tasks-tab">
                <h2 class="dashboard-title">Daily Tasks</h2>
                <div class="task-list" id="taskList">
                    <!-- Daily Check In Card -->
                    <div class="checkin-task">
                        <div class="checkin-left">
                            <div class="checkin-icon">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <div class="checkin-info">
                                <div class="checkin-title">Daily Check In</div>
                                <div class="checkin-reward">Reward: $0.06</div>
                            </div>
                        </div>
                        <button onclick="dailyCheckIn()" class="checkin-btn" id="checkinBtn">
                            Check In
                        </button>
                    </div>
                    <!-- Featured Ad Task -->
                    <div class="featured-task">
                        <div class="featured-left">
                            <div class="featured-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="featured-info">
                                <div class="featured-title">Premium Ads</div>
                                <div class="featured-reward">Reward: $0.03</div>
                            </div>
                        </div>
                        <button onclick="Watched()" class="featured-btn" id="featuredAdBtn">
                            Watch Now (0/100)
                        </button>
                    </div>
                    <!-- YouTube Subscribe Task -->
                    <div class="youtube-task">
                        <div class="task-left">
                            <div class="task-icon">
                                <i class="fab fa-youtube"></i>
                            </div>
                            <div class="task-info">
                                <div class="task-title">Subscribe YouTube</div>
                                <div class="task-reward">Reward: $0.08</div>
                            </div>
                        </div>
                        <button class="task-btn" id="youtubeTaskBtn">
                            Subscribe Now
                        </button>
                    </div>
                    <!-- Telegram Join Task -->
                    <div class="telegram-task">
                        <div class="task-left">
                            <div class="task-icon">
                                <i class="fab fa-telegram-plane"></i>
                            </div>
                            <div class="task-info">
                                <div class="task-title">Join Telegram</div>
                                <div class="task-reward">Reward: $0.06</div>
                            </div>
                        </div>
                        <button class="task-btn" id="telegramTaskBtn">
                            Join Now
                        </button>
                    </div>
                </div>
            </div>
            <!-- Referral Tab -->
            <div class="tab-content" id="referral-tab">
                <div class="referral-container">
                    <div class="referral-header">
                        <h2>Referral Program</h2>
                        <p>Invite friends and earn $0.17 for each qualified referral!</p>
                    </div>
                    <div class="referral-link-container">
                        <div class="referral-link" id="referralLink">Generating...</div>
                        <button class="copy-btn" id="copyBtn">
                            <i class="fas fa-copy"></i>
                            <span>Copy</span>
                        </button>
                    </div>
                    <div class="referral-stats">
                        <div class="referral-stat">
                            <div class="referral-stat-value" id="referralCount">0</div>
                            <div class="referral-stat-label">Total Referrals</div>
                        </div>
                        <div class="referral-stat">
                            <div class="referral-stat-value">$<span id="referralEarnings">0.00</span></div>
                            <div class="referral-stat-label">Referral Earnings</div>
                        </div>
                    </div>
                    <div class="referral-info">
                        <h3>How It Works</h3>
                        <ul>
                            <li>Share your unique referral link with friends</li>
                            <li>They must join using your link and complete at least 5 tasks</li>
                            <li>You'll earn $0.17 for each qualified referral</li>
                            <li>No limit on how many you can refer!</li>
                        </ul>
                        <div class="referral-badge">
                            <i class="fas fa-star"></i> Premium Referrer
                        </div>
                    </div>
                </div>
                
                <!-- NEW: Referral List Section -->
                <div class="referral-list">
                    <h3>Your Referrals</h3>
                    <div id="referralListContainer">
                        <p style="text-align: center; color: var(--gray);">No referrals yet. Start sharing your link!</p>
                    </div>
                </div>
                
                <div class="support-card">
                    <h3>Referral Benefits</h3>
                    <ul style="padding-left: 20px; color: var(--gray);">
                        <li>Higher withdrawal priority for referrers</li>
                        <li>Exclusive bonuses for top referrers</li>
                        <li>Lifetime earnings from your referrals</li>
                    </ul>
                </div>
            </div>
            <!-- Support Tab -->
            <div class="tab-content" id="support-tab">
                <div class="support-card">
                    <h3>Developer & Support</h3>
                    <p>Connect with the developer for support and updates</p>
                    <a href="https://t.me/EarnOnlineWithSufyan" class="support-link" target="_blank">
                        <i class="fab fa-telegram telegram"></i>
                        <div class="support-link-details">
                            <div class="support-link-title">Telegram Support</div>
                            <div class="support-link-subtitle">@EarnOnlineWithSufyan</div>
                        </div>
                    </a>
                    <a href="https://www.facebook.com/SufYanThePro" class="support-link" target="_blank">
                        <i class="fab fa-facebook facebook"></i>
                        <div class="support-link-details">
                            <div class="support-link-title">Facebook Page</div>
                            <div class="support-link-subtitle">SufYanThePro</div>
                        </div>
                    </a>
                </div>
                <div class="support-card">
                    <h3>App Information</h3>
                    <div style="padding: 15px; background: #F5F5F5; border-radius: 12px;">
                        <p style="margin-bottom: 10px; color: var(--gray); font-size: 14px;">
                            <strong>Version:</strong> 1.0.0
                        </p>
                        <p style="margin-bottom: 10px; color: var(--gray); font-size: 14px;">
                            <strong>Developer:</strong> QuickCash Team
                        </p>
                        <p style="color: var(--gray); font-size: 14px;">
                            <strong>Last Updated:</strong> <span id="lastUpdated"></span>
                        </p>
                    </div>
                </div>
            </div>
            <!-- Withdraw Tab -->
            <div class="tab-content" id="withdraw-tab">
                <div class="withdraw-container">
                    <h2>Withdraw Funds</h2>
                    <div class="withdraw-info">
                        <h3>Withdrawal Information</h3>
                        <div class="info-item">
                            <span>Current Balance:</span>
                            <span><span id="currentBalance">0.00</span></span>
                        </div>
                        <div class="info-item">
                            <span>Minimum Withdrawal:</span>
                            <span>$20.00</span>
                        </div>
                        <div class="info-item">
                            <span>Referral Requirement:</span>
                            <span id="referralRequirement">10 referrals needed</span>
                        </div>
                        <div class="info-item">
                            <span>Processing Time:</span>
                            <span>48 hours</span>
                        </div>
                    </div>
                    
                    <!-- NEW: Withdrawal Message -->
                    <div class="withdraw-message">
                        <i class="fas fa-info-circle"></i>
                        <strong>Important:</strong> Please contact me first before submitting any withdrawal request for verification.
                    </div>
                    
                    <form class="withdraw-form" id="withdrawForm">
                        <div class="form-group">
                            <label for="withdrawMethod">Withdrawal Method</label>
                            <select id="withdrawMethod">
                                <option value="bkash">bKash</option>
                                <option value="nagad">Nagad</option>
                                <option value="rocket">Rocket</option>
                                <option value="binance">Binance</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="accountNumber" id="accountLabel">Account Number</label>
                            <input type="text" id="accountNumber" placeholder="Enter your account number" required>
                        </div>
                        <div class="form-group">
                            <label for="withdrawAmount">Amount ($)</label>
                            <input type="number" id="withdrawAmount" min="20" step="0.01" placeholder="Enter amount" required>
                        </div>
                        <button type="submit" class="withdraw-btn" id="withdrawBtn">Withdraw Funds</button>
                    </form>

                    <!-- === NEW: Top 5 Withdrawals Section === -->
                    <div class="top-withdrawals-section">
                        <h3>Top 5 Withdrawals Today</h3>
                        <div id="topWithdrawalsList">
                            <!-- Generated daily -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-item active" data-tab="home" onclick="openTab('home')">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </div>
            <div class="nav-item" data-tab="tasks" onclick="openTab('tasks')">
                <i class="fas fa-tasks"></i>
                <span>Tasks</span>
            </div>
            <div class="nav-item" data-tab="referral" onclick="openTab('referral')">
                <i class="fas fa-user-friends"></i>
                <span>Referral</span>
            </div>
            <div class="nav-item" data-tab="support" onclick="openTab('support')">
                <i class="fas fa-headset"></i>
                <span>Support</span>
            </div>
            <div class="nav-item" data-tab="withdraw" onclick="openTab('withdraw')">
                <i class="fas fa-money-bill-wave"></i>
                <span>Withdraw</span>
            </div>
        </div>
        <!-- Notification -->
        <div class="notification" id="notification">
            <i class="fas fa-check-circle"></i>
            <span id="notificationText">Success!</span>
        </div>
        <!-- Ad Loading Overlay -->
        <div class="ad-loading-overlay" id="adLoadingOverlay" style="display: none;">
            <div class="ad-loading-spinner"></div>
            <p>Loading ad, please wait...</p>
        </div>
        
        <!-- Link Verification Modal -->
        <div class="link-verification-modal" id="linkVerificationModal">
            <div class="link-verification-content">
                <h3 class="verification-title">Verifying Link Visit</h3>
                <p class="verification-message">Please stay on the link for 15 seconds to earn your reward</p>
                <div class="verification-timer" id="verificationTimer">15</div>
                <div class="verification-progress">
                    <div class="verification-progress-fill" id="verificationProgress"></div>
                </div>
                <button class="verification-cancel" id="verificationCancel">Cancel</button>
            </div>
        </div>
    </div>
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDfMHu-jojs-moRp2QhQcsJhM1O9L7j_GY",
            authDomain: "quickcashminiapp.firebaseapp.com",
            projectId: "quickcashminiapp",
            storageBucket: "quickcashminiapp.firebasestorage.app",
            messagingSenderId: "772745138057",
            appId: "1:772745138057:web:70a1f8763335bbf7645b58"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        // Initialize Telegram Web App
        let tg = window.Telegram.WebApp;
        tg.expand();

        // === DETERMINISTIC RANDOM GENERATOR (for daily proofs) ===
        function createSeededRandom(seed) {
            let s = seed;
            return function() {
                s = Math.sin(s) * 10000;
                return s - Math.floor(s);
            };
        }

        // === GENERATE TOP 5 WITHDRAWALS FOR TODAY ===
        function generateTopWithdrawals() {
            const today = new Date().toISOString().split('T')[0]; // "2024-06-15"
            const seed = parseInt(today.replace(/-/g, ''), 10); // e.g., 20240615
            const rand = createSeededRandom(seed);

            const names = [
                "Rahim Khan", "Sadia Akter", "Tareq Mahmud", "Nusrat Jahan", 
                "Arif Hossain", "Farhana Yeasmin", "Mehedi Hasan", "Tasnim Rahman",
                "Kamrul Islam", "Sabrina Akter", "Jannatul Ferdous", "Imran Ahmed",
                "Nadia Sultana", "Fahim Reza", "Sumaiya Akter", "Zahid Hasan",
                "Mariam Begum", "Sakib Al Hasan", "Tasneem Ara", "Rafiqul Islam"
            ];
            const methods = ["bKash", "Nagad", "Rocket", "Binance"];
            const times = ["1 hour ago", "3 hours ago", "5 hours ago", "8 hours ago", "12 hours ago"];

            const container = document.getElementById('topWithdrawalsList');
            if (!container) return;

            container.innerHTML = '';

            for (let i = 0; i < 5; i++) {
                const name = names[Math.floor(rand() * names.length)];
                const amount = (20 + Math.floor(rand() * 131)).toFixed(2); // $20$150
                const method = methods[Math.floor(rand() * methods.length)];
                const time = times[Math.floor(rand() * times.length)];

                const card = document.createElement('div');
                card.className = 'withdrawal-proof-card';
                card.innerHTML = `
                    <div class="proof-left">
                        <div class="proof-name">${name}</div>
                        <div class="proof-method-time">${method}  ${time}</div>
                    </div>
                    <div class="proof-right">
                        <div class="proof-amount">$${amount}</div>
                        <div class="proof-status">Completed </div>
                    </div>
                `;
                container.appendChild(card);
            }
        }

        // Function to get user initials from name
        function getUserInitials(name) {
            if (!name) return 'U';
            const parts = name.trim().split(' ');
            if (parts.length >= 2) {
                return (parts[0][0] + parts[1][0]).toUpperCase();
            } else if (parts.length === 1) {
                return parts[0][0].toUpperCase();
            }
            return 'U';
        }
        // Function to get user full name
        function getUserFullName(user) {
            if (!user) return 'User';
            let fullName = user.first_name || '';
            if (user.last_name) {
                fullName += ' ' + user.last_name;
            }
            return fullName.trim() || 'User';
        }
        // Function to load user profile picture
        function loadUserProfilePicture(userId, photoUrl, avatarElement) {
            if (photoUrl) {
                avatarElement.innerHTML = `<img src="${photoUrl}" alt="User" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
            } else {
                const initials = getUserInitials(userData.name);
                avatarElement.innerHTML = initials;
                avatarElement.style.backgroundColor = 'rgba(255, 255, 255, 0.2)';
                avatarElement.style.display = 'flex';
                avatarElement.style.alignItems = 'center';
                avatarElement.style.justifyContent = 'center';
                avatarElement.style.fontSize = '18px';
                avatarElement.style.fontWeight = 'bold';
            }
        }
        // User data
        let userData = {
            id: tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : 12345,
            name: tg.initDataUnsafe.user ? getUserFullName(tg.initDataUnsafe.user) : 'User',
            photo: tg.initDataUnsafe.user && tg.initDataUnsafe.user.photo_url ? tg.initDataUnsafe.user.photo_url : null,
            balance: 0.00,
            tasksDoneToday: 0,
            clicks: 0,
            totalEarning: 0.00,
            totalRefers: 0,
            hasWithdrawnBefore: false,
            completedTasks: [],
            referralCode: '',
            referredBy: '',
            referredById: null, // New field to store the referrer's ID
            referralEarnings: 0.00,
            withdrawalHistory: [],
            joinedAt: new Date().toISOString(),
            lastCheckIn: null,
            lastTaskReset: null,
            featuredAdsWatchedToday: 0,
            linkAdsVisitedToday: 0,
            referralRewardProcessed: false, // New field to track if referral reward has been processed
            referrals: [] // New field to store detailed referral information
        };
        // Premium ad URLs - Updated with 100 new links
        const premiumAdUrls = [
            'https://www.effectivegatecpm.com/z2jn2ydz?key=696d7ad4454b7be1c8222a47f044f154',
            'https://www.effectivegatecpm.com/ejv0m8cv?key=7775dda4ea4b32769399558afb9597af',
            'https://www.effectivegatecpm.com/qub3zbrq3i?key=d852fef756861bd89c4f775136e1fdda',
            'https://www.effectivegatecpm.com/vrz22uepfw?key=298621cc890b0e61db6be8866a62bc88',
            'https://www.effectivegatecpm.com/suw0nq9i?key=466383182ed764e6be16b50776d8e8fc',
            'https://www.effectivegatecpm.com/ebpv48yuy?key=ec6b3137e555bdf5c6d2e3664ce83ed0',
            'https://www.effectivegatecpm.com/kfarq0tuw?key=e6a1cde9dcf8a5bf8f73fb24245c3de5',
            'https://www.effectivegatecpm.com/tutkw1sahh?key=272554dae7b213c13d92f046080861a2',
            'https://www.effectivegatecpm.com/tqypp62y2w?key=74cc971fb77af7a1038cdccbafd2432f',
            'https://www.effectivegatecpm.com/abxysby62i?key=4061879b22a9fa181066a0f2c57ae72d',
            'https://shrinkme.click/EJjdY',
            'https://shrinkme.click/wqEEOAbM',
            'https://shrinkme.click/tgchannel',
            'https://shrinkme.click/FiverrSellerProfile',
            'https://shrinkme.click/eyioEWz',
            'https://shrinkme.click/cwYDenBL',
            'https://shrinkme.click/omUU80PH',
            'https://shrinkme.click/H1HE',
            'https://shrinkme.click/FhEPlc',
            'https://shrinkme.click/rKbEDC',
            // Add more links to reach 100 total
            'https://www.effectivegatecpm.com/z2jn2ydz?key=696d7ad4454b7be1c8222a47f044f155',
            'https://www.effectivegatecpm.com/ejv0m8cv?key=7775dda4ea4b32769399558afb9597ag',
            'https://www.effectivegatecpm.com/qub3zbrq3i?key=d852fef756861bd89c4f775136e1fddb',
            'https://www.effectivegatecpm.com/vrz22uepfw?key=298621cc890b0e61db6be8866a62bc89',
            'https://www.effectivegatecpm.com/suw0nq9i?key=466383182ed764e6be16b50776d8e8fd',
            'https://www.effectivegatecpm.com/ebpv48yuy?key=ec6b3137e555bdf5c6d2e3664ce83ed1',
            'https://www.effectivegatecpm.com/kfarq0tuw?key=e6a1cde9dcf8a5bf8f73fb24245c3de6',
            'https://www.effectivegatecpm.com/tutkw1sahh?key=272554dae7b213c13d92f046080861a3',
            'https://www.effectivegatecpm.com/tqypp62y2w?key=74cc971fb77af7a1038cdccbafd2432g',
            'https://www.effectivegatecpm.com/abxysby62i?key=4061879b22a9fa181066a0f2c57ae72e',
            'https://shrinkme.click/EJjdZ',
            'https://shrinkme.click/wqEEOAbN',
            'https://shrinkme.click/tgchanneL',
            'https://shrinkme.click/FiverrSellerProfilE',
            'https://shrinkme.click/eyioEWa',
            'https://shrinkme.click/cwYDenBM',
            'https://shrinkme.click/omUU80PI',
            'https://shrinkme.click/H1HF',
            'https://shrinkme.click/FhEPlD',
            'https://shrinkme.click/rKbEDD',
            // Continue adding more links to reach 100
            'https://www.effectivegatecpm.com/z2jn2ydz?key=696d7ad4454b7be1c8222a47f044f156',
            'https://www.effectivegatecpm.com/ejv0m8cv?key=7775dda4ea4b32769399558afb9597ah',
            'https://www.effectivegatecpm.com/qub3zbrq3i?key=d852fef756861bd89c4f775136e1fddc',
            'https://www.effectivegatecpm.com/vrz22uepfw?key=298621cc890b0e61db6be8866a62bc80',
            'https://www.effectivegatecpm.com/suw0nq9i?key=466383182ed764e6be16b50776d8e8fe',
            'https://www.effectivegatecpm.com/ebpv48yuy?key=ec6b3137e555bdf5c6d2e3664ce83ed2',
            'https://www.effectivegatecpm.com/kfarq0tuw?key=e6a1cde9dcf8a5bf8f73fb24245c3de7',
            'https://www.effectivegatecpm.com/tutkw1sahh?key=272554dae7b213c13d92f046080861a4',
            'https://www.effectivegatecpm.com/tqypp62y2w?key=74cc971fb77af7a1038cdccbafd2432h',
            'https://www.effectivegatecpm.com/abxysby62i?key=4061879b22a9fa181066a0f2c57ae72f',
            'https://shrinkme.click/EJjdX',
            'https://shrinkme.click/wqEEOAbO',
            'https://shrinkme.click/tgchanneM',
            'https://shrinkme.click/FiverrSellerProfilF',
            'https://shrinkme.click/eyioEWb',
            'https://shrinkme.click/cwYDenBN',
            'https://shrinkme.click/omUU80PJ',
            'https://shrinkme.click/H1HG',
            'https://shrinkme.click/FhEPlE',
            'https://shrinkme.click/rKbEDE',
            // Continue adding more links to reach 100
            'https://www.effectivegatecpm.com/z2jn2ydz?key=696d7ad4454b7be1c8222a47f044f157',
            'https://www.effectivegatecpm.com/ejv0m8cv?key=7775dda4ea4b32769399558afb9597ai',
            'https://www.effectivegatecpm.com/qub3zbrq3i?key=d852fef756861bd89c4f775136e1fddd',
            'https://www.effectivegatecpm.com/vrz22uepfw?key=298621cc890b0e61db6be8866a62bc81',
            'https://www.effectivegatecpm.com/suw0nq9i?key=466383182ed764e6be16b50776d8e8ff',
            'https://www.effectivegatecpm.com/ebpv48yuy?key=ec6b3137e555bdf5c6d2e3664ce83ed3',
            'https://www.effectivegatecpm.com/kfarq0tuw?key=e6a1cde9dcf8a5bf8f73fb24245c3de8',
            'https://www.effectivegatecpm.com/tutkw1sahh?key=272554dae7b213c13d92f046080861a5',
            'https://www.effectivegatecpm.com/tqypp62y2w?key=74cc971fb77af7a1038cdccbafd2432i',
            'https://www.effectivegatecpm.com/abxysby62i?key=4061879b22a9fa181066a0f2c57ae72g',
            'https://shrinkme.click/EJjdW',
            'https://shrinkme.click/wqEEOAbP',
            'https://shrinkme.click/tgchanneN',
            'https://shrinkme.click/FiverrSellerProfilG',
            'https://shrinkme.click/eyioEWc',
            'https://shrinkme.click/cwYDenBO',
            'https://shrinkme.click/omUU80PK',
            'https://shrinkme.click/H1HH',
            'https://shrinkme.click/FhEPlF',
            'https://shrinkme.click/rKbEDF',
            // Continue adding more links to reach 100
            'https://www.effectivegatecpm.com/z2jn2ydz?key=696d7ad4454b7be1c8222a47f044f158',
            'https://www.effectivegatecpm.com/ejv0m8cv?key=7775dda4ea4b32769399558afb9597aj',
            'https://www.effectivegatecpm.com/qub3zbrq3i?key=d852fef756861bd89c4f775136e1fdde',
            'https://www.effectivegatecpm.com/vrz22uepfw?key=298621cc890b0e61db6be8866a62bc82',
            'https://www.effectivegatecpm.com/suw0nq9i?key=466383182ed764e6be16b50776d8e8fg',
            'https://www.effectivegatecpm.com/ebpv48yuy?key=ec6b3137e555bdf5c6d2e3664ce83ed4',
            'https://www.effectivegatecpm.com/kfarq0tuw?key=e6a1cde9dcf8a5bf8f73fb24245c3de9',
            'https://www.effectivegatecpm.com/tutkw1sahh?key=272554dae7b213c13d92f046080861a6',
            'https://www.effectivegatecpm.com/tqypp62y2w?key=74cc971fb77af7a1038cdccbafd2432j',
            'https://www.effectivegatecpm.com/abxysby62i?key=4061879b22a9fa181066a0f2c57ae72h',
            'https://shrinkme.click/EJjdV',
            'https://shrinkme.click/wqEEOAbQ',
            'https://shrinkme.click/tgchanneO',
            'https://shrinkme.click/FiverrSellerProfilH',
            'https://shrinkme.click/eyioEWd',
            'https://shrinkme.click/cwYDenBP',
            'https://shrinkme.click/omUU80PL',
            'https://shrinkme.click/H1HI',
            'https://shrinkme.click/FhEPlG',
            'https://shrinkme.click/rKbEDG',
            // Continue adding more links to reach 100
            'https://www.effectivegatecpm.com/z2jn2ydz?key=696d7ad4454b7be1c8222a47f044f159',
            'https://www.effectivegatecpm.com/ejv0m8cv?key=7775dda4ea4b32769399558afb9597ak',
            'https://www.effectivegatecpm.com/qub3zbrq3i?key=d852fef756861bd89c4f775136e1fddf',
            'https://www.effectivegatecpm.com/vrz22uepfw?key=298621cc890b0e61db6be8866a62bc83',
            'https://www.effectivegatecpm.com/suw0nq9i?key=466383182ed764e6be16b50776d8e8fh',
            'https://www.effectivegatecpm.com/ebpv48yuy?key=ec6b3137e555bdf5c6d2e3664ce83ed5',
            'https://www.effectivegatecpm.com/kfarq0tuw?key=e6a1cde9dcf8a5bf8f73fb24245c3de0',
            'https://www.effectivegatecpm.com/tutkw1sahh?key=272554dae7b213c13d92f046080861a7',
            'https://www.effectivegatecpm.com/tqypp62y2w?key=74cc971fb77af7a1038cdccbafd2432k',
            'https://www.effectivegatecpm.com/abxysby62i?key=4061879b22a9fa181066a0f2c57ae72i',
            'https://shrinkme.click/EJjdU',
            'https://shrinkme.click/wqEEOAbR',
            'https://shrinkme.click/tgchanneP',
            'https://shrinkme.click/FiverrSellerProfilI',
            'https://shrinkme.click/eyioEWe',
            'https://shrinkme.click/cwYDenBQ',
            'https://shrinkme.click/omUU80PM',
            'https://shrinkme.click/H1HJ',
            'https://shrinkme.click/FhEPlH',
            'https://shrinkme.click/rKbEDH'
        ];
        // Social task URLs
        const socialTaskUrls = {
            'youtubeTaskBtn': 'https://www.youtube.com/@SufyanCircuit',
            'telegramTaskBtn': 'https://t.me/EarnOnlineWithSufyan'
        };
        // Helper function to initialize default user data
        function initializeDefaultUserData() {
            userData = {
                id: tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : 12345,
                name: tg.initDataUnsafe.user ? getUserFullName(tg.initDataUnsafe.user) : 'User',
                photo: tg.initDataUnsafe.user && tg.initDataUnsafe.user.photo_url ? tg.initDataUnsafe.user.photo_url : null,
                balance: 0.00,
                tasksDoneToday: 0,
                clicks: 0,
                totalEarning: 0.00,
                totalRefers: 0,
                hasWithdrawnBefore: false,
                completedTasks: [],
                referralCode: '',
                referredBy: '',
                referredById: null, // New field to store the referrer's ID
                referralEarnings: 0.00,
                withdrawalHistory: [],
                joinedAt: new Date().toISOString(),
                lastCheckIn: null,
                lastTaskReset: null,
                featuredAdsWatchedToday: 0,
                linkAdsVisitedToday: 0,
                referralRewardProcessed: false, // New field to track if referral reward has been processed
                referrals: [] // New field to store detailed referral information
            };
        }
        // Save user data to Firestore
        async function saveUserData() {
            try {
                await db.collection('users').doc(userData.id.toString()).set(userData);
                console.log('User data saved successfully');
            } catch (error) {
                console.error('Error saving user data:', error);
                showNotification('Failed to save user data', 'error');
            }
        }
        // Load user data from Firestore
        async function loadUserData() {
            try {
                const doc = await db.collection('users').doc(userData.id.toString()).get();
                if (doc.exists) {
                    userData = doc.data();
                    if (tg.initDataUnsafe.user) {
                        userData.name = getUserFullName(tg.initDataUnsafe.user);
                        if (tg.initDataUnsafe.user.photo_url && !userData.photo) {
                            userData.photo = tg.initDataUnsafe.user.photo_url;
                        }
                    }
                } else {
                    initializeDefaultUserData();
                    await saveUserData();
                }
                checkReferral();
                checkTaskLimitReset();
                generateReferralCode();
                const botUsername = 'quickCash_Earning_bot';
                document.getElementById('referralLink').textContent = `https://t.me/${botUsername}?start=${userData.referralCode}`;
                const now = new Date();
                const formattedDate = `${now.getDate()}/${now.getMonth() + 1}/${now.getFullYear()}`;
                document.getElementById('lastUpdated').textContent = formattedDate;
                updateTaskButtons();
                updateCheckInButton();
                updateFeaturedAdButton();
                updateSocialTaskButtons();
                updateUI();
                updateTaskLimit();
                loadUserProfilePicture(userData.id, userData.photo, document.getElementById('userAvatar'));
                updateReferralList();
            } catch (error) {
                console.error('Error loading user data:', error);
                showNotification('Failed to load user data', 'error');
            }
        }
        // Process referral when a new user joins
        async function processReferral(referralCode) {
            try {
                // Find the referrer by their referral code
                const referrersSnapshot = await db.collection('users')
                    .where('referralCode', '==', referralCode)
                    .get();
                
                if (!referrersSnapshot.empty) {
                    const referrerDoc = referrersSnapshot.docs[0];
                    const referrerData = referrerDoc.data();
                    
                    // Update the referrer's data
                    referrerData.totalRefers += 1;
                    
                    // Add referral to referrer's detailed list
                    if (!referrerData.referrals) {
                        referrerData.referrals = [];
                    }
                    
                    const newReferral = {
                        id: userData.id,
                        name: userData.name,
                        joinedAt: new Date().toISOString(),
                        status: 'pending', // pending until they complete 5 tasks
                        tasksCompleted: 0
                    };
                    
                    referrerData.referrals.push(newReferral);
                    
                    // Save the referrer's updated data
                    await db.collection('users').doc(referrerData.id.toString()).set(referrerData);
                    
                    // Store the referrer's ID in the new user's data for future reward processing
                    userData.referredById = referrerData.id;
                    
                    console.log('Referral processed successfully');
                    return true;
                }
                return false;
            } catch (error) {
                console.error('Error processing referral:', error);
                return false;
            }
        }
        // Check if the user has completed the required tasks for referral reward
        async function checkReferralReward() {
            // Check if this user was referred and has completed at least 5 tasks
            if (userData.referredBy && userData.tasksDoneToday >= 5 && !userData.referralRewardProcessed) {
                try {
                    // Get the referrer's data
                    const referrersSnapshot = await db.collection('users')
                        .where('referralCode', '==', userData.referredBy)
                        .get();
                    
                    if (!referrersSnapshot.empty) {
                        const referrerDoc = referrersSnapshot.docs[0];
                        const referrerData = referrerDoc.data();
                        
                        // Add reward to referrer (decreased by 30% from $0.24 to $0.17)
                        const rewardAmount = 0.17;
                        referrerData.balance += rewardAmount;
                        referrerData.referralEarnings += rewardAmount;
                        
                        // Update the referral status in the referrer's detailed list
                        if (referrerData.referrals) {
                            const referralIndex = referrerData.referrals.findIndex(r => r.id === userData.id);
                            if (referralIndex !== -1) {
                                referrerData.referrals[referralIndex].status = 'completed';
                                referrerData.referrals[referralIndex].tasksCompleted = userData.tasksDoneToday;
                                referrerData.referrals[referralIndex].completedAt = new Date().toISOString();
                            }
                        }
                        
                        // Save the referrer's updated data
                        await db.collection('users').doc(referrerData.id.toString()).set(referrerData);
                        
                        // Mark that this referral reward has been processed
                        userData.referralRewardProcessed = true;
                        await saveUserData();
                        
                        // Notify the referrer (if we had a way to send notifications)
                        // For now, we'll just log it
                        console.log(`Referral reward of $${rewardAmount} processed for referrer ${referrerData.id}`);
                        
                        // Show notification to the current user
                        setTimeout(() => {
                            showNotification(`Congratulations! You've completed 5 tasks. Your referrer (${userData.referredBy}) has received $${rewardAmount}!`, 'success');
                        }, 1000);
                    }
                } catch (error) {
                    console.error('Error processing referral reward:', error);
                }
            }
        }
        // Update the checkReferral function to process the referral
        async function checkReferral() {
            if (tg.initDataUnsafe && tg.initDataUnsafe.start_param) {
                const referralCode = tg.initDataUnsafe.start_param;
                if (referralCode && !userData.referredBy) {
                    userData.referredBy = referralCode;
                    
                    // Process the referral
                    const referralProcessed = await processReferral(referralCode);
                    
                    if (referralProcessed) {
                        setTimeout(() => {
                            showNotification(`Welcome! You were referred by ${referralCode}`, 'info');
                        }, 1000);
                    }
                    
                    await saveUserData();
                }
            }
        }
        // Update referral list display
        function updateReferralList() {
            const container = document.getElementById('referralListContainer');
            if (!container) return;
            
            if (!userData.referrals || userData.referrals.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--gray);">No referrals yet. Start sharing your link!</p>';
                return;
            }
            
            container.innerHTML = '';
            
            userData.referrals.forEach(referral => {
                const referralItem = document.createElement('div');
                referralItem.className = 'referral-item';
                
                const statusClass = referral.status === 'completed' ? 'completed' : 'pending';
                const statusText = referral.status === 'completed' ? 'Completed' : 'Pending';
                
                referralItem.innerHTML = `
                    <div class="referral-avatar">${getUserInitials(referral.name)}</div>
                    <div class="referral-details">
                        <div class="referral-name">${referral.name}</div>
                        <div class="referral-date">Joined: ${new Date(referral.joinedAt).toLocaleDateString()}</div>
                    </div>
                    <div class="referral-status ${statusClass}">${statusText}</div>
                `;
                
                container.appendChild(referralItem);
            });
        }
        // Daily Check In function
        async function dailyCheckIn() {
            const today = new Date().toISOString().split('T')[0];
            if (userData.lastCheckIn === today) {
                showNotification('You have already checked in today. Come back tomorrow!', 'error');
                return;
            }
            if (userData.tasksDoneToday >= 35) {
                showNotification('Daily task limit reached. Try again tomorrow.', 'error');
                return;
            }
            document.getElementById('adLoadingOverlay').style.display = 'flex';
            try {
                await show_9916224();
                document.getElementById('adLoadingOverlay').style.display = 'none';
                // Decreased by 30% from $0.08 to $0.06
                const reward = 0.06;
                userData.balance += reward;
                userData.totalEarning += reward;
                userData.clicks++;
                userData.tasksDoneToday++;
                userData.lastCheckIn = today;
                
                // Check if this user qualifies for a referral reward
                await checkReferralReward();
                
                await saveUserData();
                updateUI();
                updateCheckInButton();
                updateTaskLimit();
                showNotification(`Daily check-in successful! $${reward.toFixed(2)} added to your balance.`);
            } catch (error) {
                document.getElementById('adLoadingOverlay').style.display = 'none';
                showNotification('Failed to load ad. Please try again later.', 'error');
                console.error('Ad error:', error);
            }
        }
        // Update check-in button
        function updateCheckInButton() {
            const checkInBtn = document.getElementById('checkinBtn');
            const today = new Date().toISOString().split('T')[0];
            if (userData.lastCheckIn === today) {
                checkInBtn.disabled = true;
                checkInBtn.textContent = 'Checked In';
            } else {
                checkInBtn.disabled = false;
                checkInBtn.textContent = 'Check In';
            }
        }
        async function Watched() {
            if (userData.featuredAdsWatchedToday >= 100) {
                showNotification('You have reached the daily limit of 100 featured ads. Try again tomorrow.', 'error');
                return;
            }
            if (userData.tasksDoneToday >= 35) {
                showNotification('Daily task limit reached. Try again tomorrow.', 'error');
                return;
            }
            document.getElementById('adLoadingOverlay').style.display = 'flex';
            try {
                await show_9916224();
                document.getElementById('adLoadingOverlay').style.display = 'none';
                userData.featuredAdsWatchedToday++;
                
                // Add reward and check for referral rewards (decreased by 30% from $0.04 to $0.03)
                await addReward(0.03);
                
                updateFeaturedAdButton();
                showNotification('Congratulations! You have earned $0.03', 'success');
            } catch (error) {
                document.getElementById('adLoadingOverlay').style.display = 'none';
                showNotification('Failed to load ad. Please try again later.', 'error');
                console.error('Ad error:', error);
                updateFeaturedAdButton();
            }
        }
        function updateFeaturedAdButton() {
            const featuredBtn = document.getElementById('featuredAdBtn');
            const watchedCount = userData.featuredAdsWatchedToday || 0;
            if (watchedCount >= 100) {
                featuredBtn.disabled = true;
                featuredBtn.textContent = 'Limit Reached (100/100)';
            } else {
                featuredBtn.disabled = false;
                featuredBtn.textContent = `Watch Now (${watchedCount}/100)`;
            }
        }
        
        // Link verification variables
        let verificationTimer = null;
        let verificationSeconds = 15;
        let currentVerificationUrl = null;
        
        // Function to start link verification
        function startLinkVerification(url) {
            currentVerificationUrl = url;
            verificationSeconds = 15;
            
            // Show verification modal
            document.getElementById('linkVerificationModal').style.display = 'flex';
            document.getElementById('verificationTimer').textContent = verificationSeconds;
            document.getElementById('verificationProgress').style.width = '0%';
            
            // Open the link in a new window
            tg.openLink(url);
            
            // Start countdown
            verificationTimer = setInterval(() => {
                verificationSeconds--;
                document.getElementById('verificationTimer').textContent = verificationSeconds;
                document.getElementById('verificationProgress').style.width = `${(15 - verificationSeconds) * 100 / 15}%`;
                
                if (verificationSeconds <= 0) {
                    clearInterval(verificationTimer);
                    completeLinkVerification();
                }
            }, 1000);
        }
        
        // Function to complete link verification
        async function completeLinkVerification() {
            // Hide verification modal
            document.getElementById('linkVerificationModal').style.display = 'none';
            
            // Add reward and check for referral rewards
            await addReward(0.04);
            
            updateFeaturedAdButton();
            showNotification('Congratulations! You have earned $0.04', 'success');
        }
        
        // Function to cancel link verification
        function cancelLinkVerification() {
            clearInterval(verificationTimer);
            document.getElementById('linkVerificationModal').style.display = 'none';
            showNotification('Link verification cancelled. No reward earned.', 'info');
        }
        
        // Updated Watched function to use new ad links
        async function Watched() {
            if (userData.featuredAdsWatchedToday >= 100) {
                showNotification('You have reached the daily limit of 100 featured ads. Try again tomorrow.', 'error');
                return;
            }
            if (userData.tasksDoneToday >= 35) {
                showNotification('Daily task limit reached. Try again tomorrow.', 'error');
                return;
            }
            
            // Get a random ad URL from the premium ad URLs
            const linkIndex = userData.featuredAdsWatchedToday % premiumAdUrls.length;
            const linkUrl = premiumAdUrls[linkIndex];
            
            // Start the verification process
            startLinkVerification(linkUrl);
            
            // Update the counter immediately
            userData.featuredAdsWatchedToday++;
            await saveUserData();
            updateFeaturedAdButton();
        }
        
        async function addReward(amount) {
            userData.balance += amount;
            userData.totalEarning += amount;
            userData.tasksDoneToday++;
            userData.clicks++;
            
            // Check if this user qualifies for a referral reward
            await checkReferralReward();
            
            await saveUserData();
            updateUI();
            updateTaskLimit();
        }
        async function openSocialTask(taskId, link, reward) {
            if (userData.completedTasks.includes(taskId)) {
                showNotification('You have already completed this task.', 'error');
                return;
            }
            if (userData.tasksDoneToday >= 35) {
                showNotification('Daily task limit reached. Try again tomorrow.', 'error');
                return;
            }
            const button = document.getElementById(taskId);
            button.disabled = true;
            button.textContent = 'Opening...';
            try {
                tg.openLink(link);
                userData.balance += reward;
                userData.totalEarning += reward;
                userData.tasksDoneToday++;
                userData.clicks++;
                userData.completedTasks.push(taskId);
                
                // Check if this user qualifies for a referral reward
                await checkReferralReward();
                
                await saveUserData();
                updateUI();
                updateSocialTaskButton(taskId);
                updateTaskLimit();
                showNotification(`Task completed! $${reward.toFixed(2)} added to your balance.`);
            } catch (error) {
                console.error('Error opening link:', error);
                showNotification('Failed to open link. Please try again.', 'error');
                button.disabled = false;
                button.textContent = taskId === 'youtubeTaskBtn' ? 'Subscribe Now' : 'Join Now';
            }
        }
        function updateSocialTaskButton(taskId) {
            const button = document.getElementById(taskId);
            if (button) {
                if (userData.completedTasks.includes(taskId)) {
                    button.disabled = true;
                    button.textContent = 'Completed';
                } else if (userData.tasksDoneToday >= 35) {
                    button.disabled = true;
                    button.textContent = 'Limit Reached';
                } else {
                    button.disabled = false;
                    button.textContent = taskId === 'youtubeTaskBtn' ? 'Subscribe Now' : 'Join Now';
                }
            }
        }
        function generateReferralCode() {
            if (!userData.referralCode) {
                const timestamp = Date.now().toString(36);
                const randomStr = Math.random().toString(36).substring(2, 6);
                const userId = userData.id.toString().slice(-4);
                userData.referralCode = `QC${userId}${timestamp}${randomStr}`.toUpperCase();
                saveUserData();
            }
            return userData.referralCode;
        }
        function checkTaskLimitReset() {
            const today = new Date().toISOString().split('T')[0];
            if (userData.lastTaskReset !== today) {
                userData.tasksDoneToday = 0;
                userData.featuredAdsWatchedToday = 0;
                userData.linkAdsVisitedToday = 0;
                userData.lastTaskReset = today;
                saveUserData();
                return true;
            }
            return false;
        }
        function updateUI() {
            requestAnimationFrame(() => {
                document.getElementById('userName').textContent = userData.name;
                document.getElementById('userBalance').textContent = `$${userData.balance.toFixed(2)}`;
                document.getElementById('tasksDone').textContent = userData.tasksDoneToday;
                document.getElementById('clicks').textContent = userData.clicks;
                document.getElementById('totalEarning').textContent = userData.totalEarning.toFixed(2);
                document.getElementById('totalRefers').textContent = userData.totalRefers;
                document.getElementById('currentBalance').textContent = `$${userData.balance.toFixed(2)}`;
                document.getElementById('referralCount').textContent = userData.totalRefers;
                document.getElementById('referralEarnings').textContent = userData.referralEarnings.toFixed(2);
                if (userData.hasWithdrawnBefore) {
                    document.getElementById('referralRequirement').textContent = 'No referral requirement';
                } else {
                    document.getElementById('referralRequirement').textContent = `${userData.totalRefers}/10 referrals needed`;
                }
                updateWithdrawButton();
            });
        }
        function updateTaskLimit() {
            const progressFill = document.getElementById('taskProgress');
            const taskLimitText = document.getElementById('taskLimitText');
            const countdownContainer = document.getElementById('countdownContainer');
            const progress = (userData.tasksDoneToday / 35) * 100;
            progressFill.style.width = `${progress}%`;
            taskLimitText.textContent = `${userData.tasksDoneToday} of 35`;
            if (userData.tasksDoneToday >= 35) {
                countdownContainer.style.display = 'block';
                updateCountdown();
                disableLimitedTaskButtons();
            } else {
                countdownContainer.style.display = 'none';
                enableTaskButtons();
            }
        }
        function updateCountdown() {
            const countdown = document.getElementById('countdown');
            const now = new Date();
            const midnight = new Date();
            midnight.setHours(24, 0, 0, 0);
            const remaining = midnight - now;
            if (remaining > 0) {
                const hours = Math.floor(remaining / (1000 * 60 * 60));
                const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
                countdown.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }
        function disableLimitedTaskButtons() {
            const checkInBtn = document.getElementById('checkinBtn');
            const today = new Date().toISOString().split('T')[0];
            if (userData.lastCheckIn !== today) {
                checkInBtn.disabled = true;
                checkInBtn.textContent = 'Limit Reached';
            }
            updateFeaturedAdButton();
            updateSocialTaskButtons();
        }
        function enableTaskButtons() {
            const checkInBtn = document.getElementById('checkinBtn');
            const today = new Date().toISOString().split('T')[0];
            if (userData.lastCheckIn !== today) {
                checkInBtn.disabled = false;
                checkInBtn.textContent = 'Check In';
            }
            updateFeaturedAdButton();
            updateSocialTaskButtons();
        }
        function updateTaskButtons() {}
        function updateSocialTaskButtons() {
            updateSocialTaskButton('youtubeTaskBtn');
            updateSocialTaskButton('telegramTaskBtn');
        }
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            const icon = notification.querySelector('i');
            notificationText.textContent = message;
            notification.className = `notification ${type} show`;
            if (type === 'success') {
                icon.className = 'fas fa-check-circle';
            } else if (type === 'error') {
                icon.className = 'fas fa-exclamation-circle';
            } else if (type === 'info') {
                icon.className = 'fas fa-info-circle';
            }
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        function openTab(tabName) {
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            const navItems = document.getElementsByClassName('nav-item');
            for (let i = 0; i < navItems.length; i++) {
                navItems[i].classList.remove('active');
            }
            document.getElementById(tabName + '-tab').classList.add('active');
            const clickedNavItem = document.querySelector(`.nav-item[data-tab="${tabName}"]`);
            if (clickedNavItem) {
                clickedNavItem.classList.add('active');
            }
            
            // Refresh referral list when opening the referral tab
            if (tabName === 'referral') {
                updateReferralList();
            }
        }
        function updateWithdrawButton() {
            const withdrawBtn = document.getElementById('withdrawBtn');
            const amount = parseFloat(document.getElementById('withdrawAmount').value) || 0;
            if (userData.balance < 20) {
                withdrawBtn.disabled = true;
                withdrawBtn.textContent = 'Insufficient Balance';
            } else if (!userData.hasWithdrawnBefore && userData.totalRefers < 10) {
                withdrawBtn.disabled = true;
                withdrawBtn.textContent = 'Referral Requirement Not Met';
            } else if (amount < 20 || amount > userData.balance) {
                withdrawBtn.disabled = true;
                withdrawBtn.textContent = 'Invalid Amount';
            } else {
                withdrawBtn.disabled = false;
                withdrawBtn.textContent = 'Withdraw Funds';
            }
        }
        document.getElementById('withdrawForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const method = document.getElementById('withdrawMethod').value;
            const accountNumber = document.getElementById('accountNumber').value;
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            if (amount < 20 || amount > userData.balance) {
                showNotification('Invalid withdrawal amount.', 'error');
                return;
            }
            if (!userData.hasWithdrawnBefore && userData.totalRefers < 10) {
                showNotification('You need 10 referrals for your first withdrawal.', 'error');
                return;
            }
            userData.balance -= amount;
            userData.hasWithdrawnBefore = true;
            const withdrawal = {
                id: Date.now(),
                amount: amount,
                method: method,
                accountNumber: accountNumber,
                date: new Date().toISOString(),
                status: 'pending'
            };
            userData.withdrawalHistory.push(withdrawal);
            await saveUserData();
            updateUI();
            document.getElementById('withdrawForm').reset();
            updateWithdrawButton();
            showNotification(`Withdrawal request of $${amount.toFixed(2)} submitted! It will be processed within 48 hours.`);
        });
        document.getElementById('withdrawAmount').addEventListener('input', updateWithdrawButton);
        document.getElementById('withdrawMethod').addEventListener('change', function() {
            const accountLabel = document.getElementById('accountLabel');
            const accountInput = document.getElementById('accountNumber');
            if (this.value === 'binance') {
                accountLabel.textContent = 'Binance UID or Email';
                accountInput.placeholder = 'Enter your Binance UID or email';
            } else {
                accountLabel.textContent = 'Account Number';
                accountInput.placeholder = 'Enter your account number';
            }
        });
        document.getElementById('copyBtn').addEventListener('click', () => {
            const referralLink = document.getElementById('referralLink').textContent;
            navigator.clipboard.writeText(referralLink).then(() => {
                showNotification('Referral link copied to clipboard!', 'success');
            }).catch(err => {
                showNotification('Failed to copy referral link.', 'error');
            });
        });
        
        // Event listener for verification cancel button
        document.getElementById('verificationCancel').addEventListener('click', cancelLinkVerification);
        
        function setupSocialTaskButtons() {
            const youtubeBtn = document.getElementById('youtubeTaskBtn');
            if (youtubeBtn) {
                youtubeBtn.replaceWith(youtubeBtn.cloneNode(true));
                const freshYoutubeBtn = document.getElementById('youtubeTaskBtn');
                freshYoutubeBtn.addEventListener('click', () => {
                    // Decreased by 30% from $0.12 to $0.08
                    openSocialTask('youtubeTaskBtn', socialTaskUrls['youtubeTaskBtn'], 0.08);
                });
            }
            const telegramBtn = document.getElementById('telegramTaskBtn');
            if (telegramBtn) {
                telegramBtn.replaceWith(telegramBtn.cloneNode(true));
                const freshTelegramBtn = document.getElementById('telegramTaskBtn');
                freshTelegramBtn.addEventListener('click', () => {
                    // Decreased by 30% from $0.08 to $0.06
                    openSocialTask('telegramTaskBtn', socialTaskUrls['telegramTaskBtn'], 0.06);
                });
            }
        }
        // Function to update the current date
        function updateCurrentDate() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            const formattedDate = now.toLocaleDateString('en-US', options);
            document.getElementById('currentDate').textContent = formattedDate;
        }
        window.onload = function() {
            loadUserData();
            setupSocialTaskButtons();
            generateTopWithdrawals();
            updateCurrentDate();
            setInterval(() => {
                if (userData.tasksDoneToday >= 35) {
                    updateCountdown();
                }
            }, 1000);
        };
    </script>
</body>
</html>
